{
  "name": "N8N+Nanoè¡¨å•ä¿®å›¾å·¥ä½œæµ",
  "nodes": [
    {
      "parameters": {
        "formTitle": "AIå›¾åƒåˆ›ä½œåŠ©æ‰‹ - Gemini Nano",
        "formFields": {
          "values": [
            {
              "fieldLabel": "æç¤ºè¯",
              "fieldType": "textarea",
              "requiredField": true
            },
            {
              "fieldLabel": "å‚è€ƒå›¾",
              "fieldType": "file",
              "acceptFileTypes": ".jpg,.png,.jpeg"
            }
          ]
        },
        "responseMode": "lastNode",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.formTrigger",
      "typeVersion": 2.2,
      "position": [
        -944,
        560
      ],
      "id": "f7bbb24e-3645-4fda-af69-33abeb36aead",
      "name": "On form submission",
      "webhookId": "21e3e5aa-07a7-4458-ad7d-30c11265adf5"
    },
    {
      "parameters": {
        "jsCode": "// CodeèŠ‚ç‚¹ - ç»„è£…payloadå¹¶åˆå§‹åŒ–é‡è¯•è®¡æ•°\nconst inputItems = $input.all();\nconst firstItem = $input.first();\nconst prompt = firstItem.json[\"æç¤ºè¯\"];\n\n// æ”¶é›†æ‰€æœ‰å›¾ç‰‡çš„ binary å±æ€§ååŠå…ƒæ•°æ®\nconst images = [];\nfor (let itemIndex = 0; itemIndex < inputItems.length; itemIndex++) {\n  const item = inputItems[itemIndex];\n  if (!item.binary) continue;\n\n  for (const [fieldName, binaryData] of Object.entries(item.binary)) {\n    if (binaryData?.mimeType?.startsWith('image/')) {\n      images.push({\n        itemIndex,\n        propertyName: fieldName,\n        mimeType: binaryData.mimeType,\n        fileName: binaryData.fileName || `${fieldName}`,\n      });\n    }\n  }\n}\n\n// æ„å»º content æ•°ç»„\nconst content = [];\nif (prompt && String(prompt).trim()) {\n  content.push({\n    type: \"text\",\n    text: String(prompt).trim(),\n  });\n}\n\n// å°†å›¾ç‰‡è½¬ä¸º data URLï¼ˆå…¼å®¹ filesystem / å†…å­˜ï¼‰\nasync function toDataUrl(itemIndex, propertyName, mime) {\n  // å®˜æ–¹æ¨èçš„æ–¹å¼ï¼šé€šè¿‡ helper è·å–çœŸå® Buffer\n  const buf = await this.helpers.getBinaryDataBuffer(itemIndex, propertyName); // docs: getBinaryDataBuffer\n  const b64 = buf.toString('base64');\n  return `data:${mime || 'application/octet-stream'};base64,${b64}`;\n}\n\n// å¤„ç†å›¾ç‰‡ï¼ˆè‹¥å­˜åœ¨ï¼‰\nfor (const img of images) {\n  const dataUrl = await toDataUrl.call(this, img.itemIndex, img.propertyName, img.mimeType);\n  content.push({\n    type: \"image_url\",\n    image_url: { url: dataUrl },\n  });\n}\n\n// è‹¥æ—¢æ— æ–‡æœ¬ä¹Ÿæ— å›¾ç‰‡ï¼Œåˆ™è¡¥ä¸€æ¡é»˜è®¤æ–‡æœ¬\nif (content.length === 0) {\n  content.push({\n    type: \"text\",\n    text: \"è¯·åˆ†æè¿™ä¸ªå†…å®¹\",\n  });\n}\n\n// æ„å»º payload\nconst payload = {\n  model: \"google/gemini-2.5-flash-image-preview\",\n  messages: [\n    {\n      role: \"user\",\n      content,\n    },\n  ],\n};\n\n// è¿”å› payload å’Œé‡è¯•è®¡æ•°\nreturn [\n  {\n    json: {\n      apiPayload: payload,\n      retryCount: 0,\n      maxRetries: 5,\n      originalFormData: firstItem.json,\n    },\n  },\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -736,
        560
      ],
      "id": "9f19d6ec-94bc-4e45-8adb-26f7942f8af3",
      "name": "Code"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://openrouter.ai/api/v1/chat/completions",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "openRouterApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json.apiPayload }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -464,
        560
      ],
      "id": "bd9cde31-7912-4b2c-b48e-a222e6ddd0ff",
      "name": "HTTP Request",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "merge-api-response",
              "name": "apiResponse",
              "value": "={{ $json }}",
              "type": "object"
            },
            {
              "id": "keep-max-retries",
              "name": "maxRetries",
              "value": "={{ $('Code').item.json.maxRetries }}",
              "type": "number"
            },
            {
              "id": "keep-api-payload",
              "name": "apiPayload",
              "value": "={{ $('Code').item.json.apiPayload }}",
              "type": "object"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -240,
        512
      ],
      "id": "a30a2b4f-5d8b-45e7-8bb5-46374129ce14",
      "name": "Merge Response Data"
    },
    {
      "parameters": {
        "errorMessage": "ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•"
      },
      "type": "n8n-nodes-base.stopAndError",
      "typeVersion": 1,
      "position": [
        -240,
        672
      ],
      "id": "f5031064-b423-42b4-8533-e257dbec8154",
      "name": "Network Error"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "content-filter-check",
              "leftValue": "={{ $json.apiResponse.choices[0].finish_reason === \"content_filter\" }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -48,
        480
      ],
      "id": "a0940f04-f043-477d-9070-7306671b3406",
      "name": "Content Filter Check"
    },
    {
      "parameters": {
        "operation": "completion",
        "completionTitle": "æŠ±æ­‰ï¼Œæ‚¨çš„å†…å®¹åŒ…å«ä¸å½“ä¿¡æ¯",
        "completionMessage": "è¯·é‡æ–°ä¸Šä¼ å‚è€ƒå›¾æˆ–è€…ä¿®æ”¹æç¤ºè¯åé‡è¯•",
        "options": {}
      },
      "type": "n8n-nodes-base.form",
      "typeVersion": 1,
      "position": [
        176,
        352
      ],
      "id": "3a751c1f-068b-4ca7-8a9e-8feaf7a17e15",
      "name": "Prohibited Content End",
      "webhookId": "ab2bbb52-451d-4979-b416-3178be0a5dcd"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "image-exists-check",
              "leftValue": "={{ $json.apiResponse.choices[0].message.images }}",
              "rightValue": "",
              "operator": {
                "type": "array",
                "operation": "notExists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        176,
        560
      ],
      "id": "f6f18ff8-a1ea-47fd-9884-89b71533fbda",
      "name": "Image Check"
    },
    {
      "parameters": {
        "amount": 10
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        368,
        688
      ],
      "id": "4359cd3f-2c38-4cd8-8988-7c1764d41753",
      "name": "Wait",
      "webhookId": "a29b54b5-40ae-4e0d-8972-7f3339d39840"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "extract-base64",
              "name": "base",
              "value": "={{ $json.apiResponse.choices[0].message.images[0].image_url.url.split(\",\")[1] }}",
              "type": "string"
            },
            {
              "id": "extract-mime",
              "name": "mime",
              "value": "={{ $json.apiResponse.choices[0].message.images[0].image_url.url.match(/^data:([^;]+)/)[1] }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        384,
        448
      ],
      "id": "8490f183-de5a-45ae-b12c-f7ebbbb3f471",
      "name": "Extract Image Data"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "base",
        "options": {}
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        576,
        448
      ],
      "id": "1c18d6c6-220f-4611-988a-6e6cc611ae02",
      "name": "Convert to File"
    },
    {
      "parameters": {
        "operation": "completion",
        "respondWith": "returnBinary",
        "completionTitle": "ğŸ‰ æ‚¨çš„å›¾ç‰‡å·²ç”Ÿæˆå®Œæˆï¼",
        "options": {}
      },
      "type": "n8n-nodes-base.form",
      "typeVersion": 1,
      "position": [
        736,
        448
      ],
      "id": "f668e7c3-adce-432b-b4a0-2be19c9723a2",
      "name": "Success Form",
      "webhookId": "25759210-625c-49dc-8473-b283281db0f4"
    },
    {
      "parameters": {
        "content": "#### é…ç½® OpenRouter å‡­è¯ ğŸ‘‡",
        "height": 80,
        "width": 214,
        "color": 3
      },
      "id": "79901d4f-e3e4-4a12-a485-637614eb8756",
      "name": "Sticky Note12",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -528,
        512
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "ğŸ¨ N8N+Nanoè¡¨å•ä¿®å›¾å·¥ä½œæµ\nğŸ“‹ åŸºæœ¬ä¿¡æ¯\nâ€¢ å·¥ä½œæµåç§°ï¼šNano-Form-Image-Editor  \nâ€¢ ç‰ˆæœ¬ï¼šv1.0.0\nâ€¢ æŠ€æœ¯æ ˆï¼šN8N + OpenRouter + Form Trigger  \nâ€¢ æ”¯æŒæ¨¡å¼ï¼šæ–‡ç”Ÿå›¾ + å›¾ç‰‡ä¿®å›¾  \nâ€¢ åˆ›å»ºè€…ï¼štianxinAI  \nâ€¢ å¾®ä¿¡ï¼štianxinAI360\nğŸ¯ åŠŸèƒ½æ¦‚è¿°\nåŸºäºè¡¨å•çš„AIå›¾åƒåˆ›ä½œåŠ©æ‰‹ï¼Œæ”¯æŒçº¯æ–‡ç”Ÿå›¾å’Œä¸Šä¼ å›¾ç‰‡ä¿®å›¾ä¸¤ç§æ¨¡å¼ã€‚ç”¨æˆ·é€šè¿‡è¡¨å•ç•Œé¢æäº¤æç¤ºè¯å’Œå¯é€‰å‚è€ƒå›¾ï¼Œç³»ç»Ÿæ™ºèƒ½è¯†åˆ«éœ€æ±‚å¹¶è°ƒç”¨Nanoæ¨¡å‹ç”Ÿæˆé«˜è´¨é‡å›¾ç‰‡ã€‚\nâš™ï¸ é…ç½®è¯´æ˜\nForm Triggeré…ç½®\nâ—‹ è¡¨å•æ ‡é¢˜ï¼šAIå›¾åƒåˆ›ä½œåŠ©æ‰‹ - Gemini Nano  \nâ—‹ æç¤ºè¯å­—æ®µï¼šå¿…å¡«æ–‡æœ¬åŸŸï¼Œæ”¯æŒè¯¦ç»†æè¿°  \nâ—‹ å‚è€ƒå›¾å­—æ®µï¼šå¯é€‰æ–‡ä»¶ä¸Šä¼ ï¼Œæ”¯æŒ.jpg/.png/.jpeg  \nCodeèŠ‚ç‚¹å…³é”®é€»è¾‘  \nâ—‹ æ™ºèƒ½è¯†åˆ«ä¸Šä¼ çš„å›¾ç‰‡æ–‡ä»¶  \nâ—‹ è‡ªåŠ¨ç»„è£…å¤šæ¨¡æ€APIè¯·æ±‚ä½“  \nâ—‹ å¤„ç†æ–‡æœ¬+å›¾ç‰‡çš„å¤åˆè¾“å…¥  \nğŸ’¡ ä½¿ç”¨åœºæ™¯\nâ€¢ çº¯æ–‡ç”Ÿå›¾ï¼šåªå¡«å†™æç¤ºè¯ï¼Œå¿«é€Ÿç”Ÿæˆåˆ›æ„å›¾ç‰‡  \nâ€¢ AIä¿®å›¾ï¼šä¸Šä¼ å‚è€ƒå›¾+æè¿°éœ€æ±‚ï¼Œæ™ºèƒ½å›¾ç‰‡ç¼–è¾‘  \nâ€¢ é£æ ¼è½¬æ¢ï¼šå°†ç°æœ‰å›¾ç‰‡è½¬æ¢ä¸ºä¸åŒè‰ºæœ¯é£æ ¼  \nâ€¢ è§’è‰²åˆ›ä½œï¼šæ ¹æ®æè¿°ç”Ÿæˆè§’è‰²å½¢è±¡æˆ–æ‰‹åŠæ•ˆæœ",
        "height": 752,
        "width": 2208,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1312,
        192
      ],
      "typeVersion": 1,
      "id": "980c72c9-49f1-4577-afbb-ec05ebb2a6c5",
      "name": "Sticky Note"
    }
  ],
  "pinData": {},
  "connections": {
    "On form submission": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Merge Response Data",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Network Error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Response Data": {
      "main": [
        [
          {
            "node": "Content Filter Check",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Content Filter Check": {
      "main": [
        [
          {
            "node": "Prohibited Content End",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Image Check",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Image Check": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Extract Image Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Image Data": {
      "main": [
        [
          {
            "node": "Convert to File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File": {
      "main": [
        [
          {
            "node": "Success Form",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "ef37a5a8-701e-4fa9-a388-43d88169a2a3",
  "meta": {
    "instanceId": "a5f08ede13bceab7d066ab11fb03ba9312e3e584a39630194ecaef89c79e9ee1"
  },
  "id": "lDcTMnure5EL4XhZ",
  "tags": [
    {
      "createdAt": "2025-12-24T03:15:29.885Z",
      "updatedAt": "2025-12-24T03:15:29.885Z",
      "id": "NhiSIK0T28SNNoyh",
      "name": "auto-flow-academy"
    }
  ]
}